<!doctype html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" type="text/css" href="../../_css/styles.css">

	<title>MongoDB</title>
</head>

<body>


	<nav class="navbar">
		<a href="../../index.html">Back to homepage</a>
		<a class="nav-page nav-active">MongoDB Running Commands</a>
	</nav>



	<h1>Running commands</h1>
	<h2>Start the server and Shell</h2>
	<div class="text-section">
		<p>You must first start by starting the MongoDB server. Then, open a Shell to run commands.</p>
	</div>

	<h3>Start the server</h3>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>Open PowerShell.</p>
			<p>Run <span class="code">mongod.exe</span>.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">mongod.exe</span></pre>
		</div>
	</section>

	<h3>Open the Shell</h3>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>Open PowerShell.</p>
			<p>Run <span class="code">mongo</span>.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">mongo</span></pre>
		</div>
	</section>

	<h3>Quit the Shell</h3>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>Run <span class="code">quit()</span> when you're ready to close the Shell.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">&gt; quit()</span></pre>
		</div>
	</section>


	<h1>Database</h1>
	<h2>Create a new database</h2>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>Run the <span class="code">use</span> command to create a new database or switch to an existing database.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">&gt; use natours-test
switched to db natours-test</span></pre>
		</div>
	</section>

	<h2>Show all databases</h2>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>This commands lists all databases.</p>
			<p><span class="text-object">admin</span>, <span class="text-object">config</span>, and <span
					class="text-object">local</span> are default databases.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">&gt; show dbs</span></pre>
		</div>
	</section>



	<h1>Collections</h1>

	<h2>Show Collections</h2>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>This command lists all Collections in a database.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">&gt; show collections</span></pre>
		</div>
	</section>






	<h1>Documents</h1>
	<h2>Create a new document</h2>
	<div class="text-section">
		<p>Creating a new document follows this syntax:</p>
		<p><span class="code-highlight">DATABASE.COLLECTION.FUNCTION("object")</span></p>
	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>The command starts with the current database. This is noted by <span class="code">db</span>.</p>
			<p>To create a new document, you must first specify a collection. In this example, <span class="code">tours</span>
				is the collection.</p>
			<p>Create a document inside of this collection using the <span class="code">insertOne()</span> function.</p>
			<p>In the <span class="code">insertOne()</span> function, pass in a JavaScript Object.</p>

		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">&gt; db.tours.insertOne({ name: "The Forest Hiker", price: 297, rating: 4.7})
{
  "acknowledged" : true,
  "insertedId" : ObjectId("61e9e02f5eb0346bcc45d3a8")
}        </span></pre>
		</div>
	</section>






	<h2>Create multiple documents</h2>
	<div class="text-section">
		<p>Use <span class="code">insertMany()</span> to insert multiple documents.</p>
		<p>This accepts an Array of multiple objects.</p>
	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Create an Array using <span class="code">[]</span>.</p>
			<p>Add Objects within the Array.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">&gt; db.tours.insertMany([{name: "The Sea Explorer", price: 497, rating: 4.8 }, { name: "The Snow Adventurer", price: 997, rating: 4.9, difficulty: "easy"}])</span>
{
  "acknowledged" : true,
  "insertedIds" : [
    ObjectId("6254917a4b556a73e5dc893b"),
    ObjectId("6254917a4b556a73e5dc893c")
  ]
}  </pre>
		</div>
	</section>



	<h1>Querying Documents</h1>

	<h2>Query all Documents in a Collection</h2>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>Use the <span class="code">find()</span> command to view all Documents in a Collection.</p>
			<p>Note how MongoDB automatically creates a unique <span class="code">ObjectId</span> for the Document.</p>
		</div>
		<div class="code-block-section-w60">
			<pre
				class="example"><span class="code-nodejs">&gt; db.tours.find()
{ "_id" : ObjectId("61e9e02f5eb0346bcc45d3a8"), "name" : "The Forest Hiker", "price" : 297, "rating" : 4.7 }</span></pre>
		</div>
	</section>



	<h2>Query a property value</h2>

	<div class="text-section">
		<p>This command returns all documents that contain the specific property value queried.</p>
	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Add an Object into the <span class="code">find()</span> method.</p>
			<p>Pass in the filter.</p>
			<p>In this example, you are searching for the 'name' property.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">db.tours.find({ name: "The Forest Hiker" })</span>
{ "_id" : ObjectId("61e9e02f5eb0346bcc45d3a8"), "name" : "The Forest Hiker", "price" : 297, "rating" : 4.7 }</pre>
		</div>
	</section>







	<h2>Query a property value LESS THAN or EQUAL to a specific amount</h2>

	<div class="text-section">
		<p>This returns all documents where the 'price' property is LESS THAN 500.</p>
	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Create a new Object for the value to search for surrounded by {}.</p>
			<p>Use the LESS THAN or EQUAL operator. <span class="code">$lte</span>. This is a Mongo Operator.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">db.tours.find({ price: {$lte: 500} })</span></pre>
		</div>
	</section>









	<h2>Query for multiple values</h2>

	<div class="text-section">
		<p>This returns all documents where the 'price' property is LESS THAN 500, and if the rating is greater than 4.8.
		</p>
	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Use the LESS THAN operator to query a value.</p>
			<p>Add a comma, then the next query.</p>
			<p>The next query uses the GREATER THAN or EQUAL operator.</p>
		</div>
		<div class="code-block-section-w60">
			<pre
				class="example"><span class="code-nodejs">db.tours.find({ price: {$lt: 500}, rating: {$gte: 4.8} })</span></pre>
		</div>
	</section>





	<h2>OR query for multiple values</h2>

	<div class="text-section">
		<p>This checks if only 1 value is true.</p>
	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Start with the <span class="code">$or</span> Operator.</p>
			<p>THis is followed by an Array.</p>
			<p>Inside the Array you add the conditions.</p>
		</div>
		<div class="code-block-section-w60">
			<pre
				class="example"><span class="code-nodejs">db.tours.find({ $or: [ {price: {$lt: 500}}, {rating: {$gte: 4.8}}  ] })</span></pre>
		</div>
	</section>







	<h2>Output only a specific property</h2>

	<div class="text-section">
		<p>This will query, but only output the 'name' property.</p>
	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>After the Array, add the property to output.</p>
		</div>
		<div class="code-block-section-w60">
			<pre
				class="example"><span class="code-nodejs">db.tours.find({ $or: [ {price: {$lt: 500}}, {rating: {$gte: 4.8}}  ] }, <span class="code-highlight">{name: 1}</span>)</span></pre>
		</div>
	</section>













	<h1>Updating Documents: CRUD</h1>

	<h2>Update a document</h2>
	<div class="text-section">
		<p>This uses <span class="code">updateOne()</span> to update a single document.</p>

	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>The first element is a filter Object. It's what you're going to update.</p>
			<p>The second element is the new value. Use <span class="code">$set</span> to update by creating a new Object.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">db.tours.updateOne({ name: "The Snow Adventurer"}, { $set: {price: 597} })</span>
{ "acknowledged" : true, "matchedCount" : 1, "modifiedCount" : 1 }</pre>
		</div>
	</section>




	<h2>Update multiple documents</h2>
	<div class="text-section">
		<p>This uses <span class="code">updateMany()</span> to update a several documents.</p>

	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>The first two elements are search for what to update.</p>
			<p>The second uses the <span class="code">$set</span> operator to add a new property value of premium: true.</p>
		</div>
		<div class="code-block-section-w60">
			<pre
				class="example"><span class="code-nodejs">db.tours.updateMany({ price: {$gt: 500}, rating: {$gte: 4.8}}, { $set: {premium: true}})</pre>
		</div>
	</section>









	<h1>Deleting documents</h1>

	<h2>deleteOne()</h2>
	<div class="text-section">
		<p>This deletes the first document matching the query.</p>
	</div>


	<h2>deleteMany()</h2>
	<div class="text-section">
		<p>This deletes all documents matching the query.</p>
	</div>


	<section class="code-section-container">
		<div class="code-text-section">
			<p>Delete tours with rating below 4.8.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">db.tours.deleteMany({ rating: {$lt: 4.8} })</span></pre>
		</div>
	</section>


	<h2>Delete all documents</h2>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>Pass in an empty objet to delete all documents.</p>
			<p>This is permanent.</p>

		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">db.tours.deleteMany({})</span></pre>
		</div>

	</section>










	<h1>Using COMPASS for CRUD operations</h1>
	<p>Compass is a GUI to work with Mongo.</p>

	<h2>Download from website.</h2>
	<div class="text-section">
		<ul>
			<li><a href="https://www.mongodb.com/products/compass" target="_blank">Download Compass</a></li>

		</ul>
	</div>

	<h2>Start the monogo server in the background</h2>

	<h2>Open Compass</h2>
	<div class="text-section">
		<p>Make sure you're on the 'New Connectin' screen.</p>
		<img src="../../_img/compass.png">
		<p>Everything should already be configured to use localhost and your mongo port.</p>
		<p>Click the 'Connect' button to load your environment.</p>
		<img src="../../_img/compass-dbs.png">
		<p>All databases are listed.</p>
	</div>

	<h2>Insert a Document</h2>
	<div class="text-section">
		<p>Click into your database.</p>
		<img src="../../_img/compass-add-data.png">
		<p>Click the 'Add Data' dropdown, then 'Insert Document'.</p>
		<img src="../../_img/compass-insert-document.png">

		<p>Add new properties and values.</p>
		<p>NOTE: You must enter it exacty as shown or it will not validate.</p>

	</div>

	<h2>Query a property</h2>
	<div class="text-section">
		<p>Use the same syntax as in the Mongo shell.</p>
		<img src="../../_img/compass-query.png">
		<p>Click the 'Options' dropdown to refine the results. This examle show the 'Project' field adding a search for the
			name. The results will then only contain the name property and no others.</p>
		<img src="../../_img/compass-query-options.png">

	</div>












	<h1>Atlas App</h1>
	<div class="text-section">
		<p>Download Atlas from the MongoDB website.</p>
		<p>Create a new Project.</p>
	</div>



	<h2>Connect Atlas to your local app</h2>
	<div class="text-section">
		<p>You must now update your application <span class="code">config.env</span> file so it can connect to Atlas.</p>
	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Add your user Atlas cluster password to the file.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">NODE_ENV=development
PORT=3000
DATABASE_PASSWORD=<span class="code-highlight">#######</span></span></pre>
		</div>


	</section>


	<h2>Connect Atlas to your local Compass</h2>
	<div class="text-section">
		<p>This connects Atlas to your local install of Compass.</p>
		<p>What you create in Compass will then appear in Atlas.</p>
		<p>In Atlas...</p>
		<ol>
			<li>View your list of projects.</li>
			<li>Click your project name.
				<dl>
					<dd>
						<img src="../../_img/atlas-build-a-database.png" width="500px">
					</dd>
				</dl>
			</li>
			</li>
			<li>Click the <span class="text-object">Build a Database</span> button.</li>
			<li>Click the FREE option.</li>
			<li>Choose a cluster provider. Click <span class="text-object">Create Cluster</span>.</li>
			<li>Create a username and password.</li>
			<li>Click to add your current IP address.</li>
			<li>Click <span class="text-object">Finish and Close</span>. The cluster will take a few minutes to create.</li>
			<li>After the cluster is created, click the <span class="text-object">Connect</span> button.</li>
			<li>Choose the option to connect with Compass.
				<dl>
					<dd>
						<img src="../../_img/atlas-connect-connection-string.png" width="500px">
					</dd>
				</dl>
			</li>
			<li>Copy the connection string.</li>
			<li>Open Compass. <dl>
					<dd>
						<img src="../../_img/compass-connection-string.png" width="500px">
					</dd>
				</dl>
			</li>
			<li>Enter the connection string. Make sure to update your password and database name.</li>
			<li>Click <span class="text-object">Connect</span>.</li>
			<li>After the next page loads, you'll see <span class="text-object">admin</span> and <span
					class="text-object">local</span> listed.</li>
			<li>Click <span class="text-object">Create database</span> on the top left.</li>
			<li>Add a <span class="text-object">Database Name</span> and <span class="text-object">Collection Name</span>.
			</li>
			<li>Click <span class="text-object">Create database</span>.</li>
			<li>This new database appears in the list under <span class="text-object">admin</span> and <span
					class="text-object">local</span>.</li>
			<li>Insert a document.</li>
			<li>Open Atlas in your browser.
				<dd>
					<img src="../../_img/atlas-cluster-info.png" width="500px">
				</dd>
				</dl>
			</li>
			<li>Click the <span class="text-object">Collections</span> tab to view your new database and collection.</li>
		</ol>
	</div>

	<h2>Whitelist all IP addresses</h2>
	<div class="text-section">
		<p>This allows you to work on your project for any computer.</p>
		<p>This is only useful if the database contains NO sensitive information.</p>

		<ol>
			<li>Open Atlas in your browser.</li>
			<li>On the left, click <span class="text-object">Network Access</span>.</li>
			<li>On the top right click <span class="text-object">+ ADD IP ADDRESS</span>.
				<dl>
					<dd>
						<img src="../../_img/atlas-network-access.png" width="500px">
					</dd>
				</dl>
			</li>
			<li>Click the button <span class="text-object">Allow Access from Anywhere</span>, then click <span
					class="text-object">Confirm</span>.</li>

		</ol>
	</div>






	<h2>Connect Atlas with your Mongo Shell</h2>
	<div class="text-section">
		<p>This connects Atlas with your local Mongo Shell environment.</p>

		<ol>
			<li>Open Atlas in your browser.
				<dl>
					<dd>
						<img src="../../_img/atlas-connect.png" width="500px">
					</dd>
				</dl>
			</li>
			<li>On the next popup click <span class="text-object">Connect with the MongoDB Shell</span>.
				<dl>
					<dd>
						<img src="../../_img/atlas-connect-connection-string-shell.png" width="500px">
					</dd>
				</dl>

			</li>
			<li>Copy the connection string.</li>
			<li>Open your terminal. Make sure a Mongo Shell is not already running. If so, type in <span
					class="code">quit()</span> to return to the Shell.</li>
			<li>Paste in your new mongo string. NOTE: Change <span class="code">mongosh</span> at the beginning of the string
				to <span class="code">mongo</span>.</li>
			<li>Enter your user password.</li>
			<li>View your databases: <span class="code">show dbs</span>.</li>
			<li>Switch to it: <span class="code">use natours</span>.</li>
			<li>View the document you previously created: <span class="code">db.tours.find()</span>.</li>

		</ol>
	</div>





	<h2>Connect your app to Atlas</h2>

	<div class="text-section">
		<p>This connects Atlas with your local app.</p>

		<ol>
			<li>Open Atlas in your browser.
				<dl>
					<dd>
						<img src="../../_img/atlas-connect.png" width="500px">
					</dd>
				</dl>
			</li>
			<li>On the next popup click <span class="text-object">Connect your application</span>.

			</li>
			<li>Make sure the <span class="text-object">Driver</span> dropdown is set to <span
					class="text-object">Node.js</span>.</li>
			<li> Copy the connection string.</li>
			<li>

				<section class="code-section-container">
					<div class="code-text-section">
						<p>Update the password field. You could also leave it as <span class="code">&lt;PASSWORD&gt;</span> The
							<span class="code">server.js</span> file would then use the enviornmental variable from <span
								class="text-object">config.env</span> to fill it in.
						</p>
						<p>Change <span class="code">myFirstDatabse</span> to the database name in Compass.</p>
					</div>
					<div class="code-block-section-w60">
						<pre class="example"><span class="code-nodejs">NODE_ENV=development
PORT=3000
<span class="code-highlight">DATABASE=mongodb+srv://cjdh22:password@cluster0.8y3ej.mongodb.net/myFirstDatabase?retryWrites=true&w=majority</span>
DATABASE_PASSWORD=password</span></pre>
					</div>
				</section>

				<section class="code-section-container">
					<div class="code-text-section">
						<p>If you want to use your local database instead of Atlas, use this connection string instead.</p>
						<p>NOTE: The local mongo server must be running for the connection to work.</p>
					</div>
					<div class="code-block-section-w60">
						<pre class="example"><span class="code-nodejs">NODE_ENV=development
PORT=3000
<span class="code-highlight">DATABASE_LOCAL=mongodb://localhost:27017/databasename</span>
DATABASE_PASSWORD=password</span></pre>
					</div>
				</section>
			</li>

		</ol>
	</div>







	<h1>Mongoose</h1>

	<h2>Overview</h2>

	<div class="text-section">
		<p>Mongoose is an Object Data Modeing (ODM) library for MongoDB and Node.js providing a higher level of abstraction.
		</p>
		<p>It's similar to the abstraction provided by Express to Node.js.</p>
		<p>An ODM is is a way to write JavaScript to interact with a database.</p>
		<p>You don't need to use Mongoose, but it comes with a lot of functionality right out of the box allowing for faster
			and more simple development of MongoDB applications.</p>
	</div>

	<h3>Mongoose Schema</h3>
	<div class="text-section">
		<p>This is where you model your data by describing the structure of the data, default values, and validation.</p>

		<h3>Model</h3>
		<p>You use the Schema to create a model. The model is a wrapper around the schema prividing an interface to teh
			database for CRUD operations.</p>
		<p>Models are like blueprints used to create documents.</p>
		<p>It's like classes in JavaScript when used to create Objects from them.</p>
		<p>Create a model so you can create a document from it and run CRUD operations on it.</p>






	</div>



	<h2>Install Mongoose</h2>
	<div class="text-section">
		<p>Install Mongoose in your Node.js application.</p>
		<p><span class="code">npm i mongoose</span></p>
	</div>



	<h2>Configure server.js to use Mongoose to connect to Atlas database</h2>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Add a variable to store mongoose.</p>
			<p>Repace the password in the database string with the password variable in the <span
					class="text-object">config.env</span> file.</p>
			<p>Create a connection to the database using <span class="code">mongoose.connect()</span>.</p>
			<p>Run <span class="code">npm start</span> to run the file. You should see the success message.</p>


		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs"><span class="code-highlight">const mongoose = require('mongoose');</span>
const dotenv = require('dotenv');
const app = require('./app');

dotenv.config({ path: './config.env' });

<span class="code-comment">// process.env.DATABASE is the variable in the config.env file
// This replaces the password variable in the connection string with the real password from the password variable</span>
<span class="code-highlight">const DB = process.env.DATABASE.replace('<PASSWORD>', process.env.DATABASE_PASSWORD);</span>

<span class="code-comment">// pass in database connection string
// then pass in an Object with some options (these deal with deprecation warnings)
// This connection returns a promise. Handle it using then()
// This gives you access to a connection Object</span>
<span class="code-highlight">mongoose.connect(DB, {
  useNewUrlParser: true,
  useCreateIndex: true,
  useFindAndModify: false
  }) <span class="code-comment">// this connection will be the resolved value of the Promise</span>
  .then(() => console.log('DB connection successful'));</span>

const port = process.env.PORT || 3000;
app.listen(port, () => {
	console.log(`App running on port ${port}...`);
});</span></pre>
		</div>
	</section>




	<h2>Configure server.js to use Mongoose to connect to local database</h2>
	<div class="text-section">
		<p>This is if you choose to not use Atlas to host the database and want it hosted locally.</p>
	</div>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Same as above, but you would change the database connection to <span
					class="code">process.env.DATABASE_LOCAL</span>.</p>
			<p>This variable is set in the <span class="text-object">config.env</span> file.</p>


		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">const mongoose = require('mongoose');
const dotenv = require('dotenv');
const app = require('./app');

dotenv.config({ path: './config.env' });


const DB = process.env.DATABASE.replace('<PASSWORD>', process.env.DATABASE_PASSWORD);

mongoose.connect(<span class="code-highlight">process.env.DATABASE_LOCAL,</span>  {
  useNewUrlParser: true,
  useCreateIndex: true,
  useFindAndModify: false
  })
  .then(() => console.log('DB connection successful'));

const port = process.env.PORT || 3000;
app.listen(port, () => {
	console.log(`App running on port ${port}...`);
});</span></pre>
		</div>



	</section>





	<h2>Create a simple Tour model</h2>

	<h3>Step #1: Create a Schema</h3>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>Add to the <span class="code">server.js</span> file.</p>
			<p>First create a Schema you can use to create a Model.</p>
			<p>This is a very simple example of a Schema. Just add the data type after the property.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">const mongoose = require('mongoose');
const dotenv = require('dotenv');
const app = require('./app');

dotenv.config({ path: './config.env' });

const DB = process.env.DATABASE.replace(
 '&lt;PASSWORD&gt;',
 process.env.DATABASE_PASSWORD
);

mongoose
 .connect(DB, {
   useNewUrlParser: true,
	 useCreateIndex: true,
	 useFindAndModify: false
})
.then(() =&gt; console.log('DB connection successful'));

<span class="code-comment">// Create Schema. Pass in the Schema as an Object</span>
<span class="code-highlight">const tourSchema = new mongoose.Schema({
 name: String,
 rating: Number,
 price: Number
});</span>

const port = process.env.PORT || 3000;
app.listen(port, () =&gt; {
	console.log(`App running on port ${port}...`);
});</span></pre>
		</div>
	</section>




	<h4>Add Schema-type options</h4>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>This adds on to the example above.</p>
			<p>Instead of specifying <span class="code">String</span>, pass in another Object.</p>
			<p>Schema-type options can be different for different types. Such as Strings or Numbers.</p>
			<p>This example adds Schema-types of <span class="code">type</span> and <span class="code">required</span>.</p>




		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">const mongoose = require('mongoose');
const dotenv = require('dotenv');
const app = require('./app');

dotenv.config({ path: './config.env' });

const DB = process.env.DATABASE.replace(
 '&lt;PASSWORD&gt;',
 process.env.DATABASE_PASSWORD
);

mongoose
 .connect(DB, {
   useNewUrlParser: true,
	 useCreateIndex: true,
	 useFindAndModify: false
})
.then(() =&gt; console.log('DB connection successful'));

<span class="code-comment">// Create Schema. Pass in the Schema as an Object</span>
const tourSchema = new mongoose.Schema({
  name: <span class="code-highlight">{
    type: String,
    required: true,
		unique: true
  },</span>
  rating: <span class="code-highlight">{
    type: Number,
    default: 4.5
  }</span>,
  price: <span class="code-highlight">{
    type: Number,
    required: true
  }</span>
});

const port = process.env.PORT || 3000;
app.listen(port, () =&gt; {
	console.log(`App running on port ${port}...`);
});</span></pre>
		</div>
	</section>













	<h4>Add Array to throw error if required field is missing</h4>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>
			<p>This adds an Array to throw an error if the <span class="code">required</span> field is not entered.
			</p>



		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">const mongoose = require('mongoose');
const dotenv = require('dotenv');
const app = require('./app');

dotenv.config({ path: './config.env' });

const DB = process.env.DATABASE.replace(
 '&lt;PASSWORD&gt;',
 process.env.DATABASE_PASSWORD
);

mongoose
 .connect(DB, {
   useNewUrlParser: true,
	 useCreateIndex: true,
	 useFindAndModify: false
})
.then(() =&gt; console.log('DB connection successful'));

<span class="code-comment">// Create Schema. Pass in the Schema as an Object</span>
const tourSchema = new mongoose.Schema({
  name: {
    type: String,
    required: <span class="code-highlight">[true, 'A tour must have a name']</span>,
		unique: true
  },
  rating: {
    type: Number,
    default: 4.5
  },
  price: {
    type: Number,
    required: <span class="code-highlight">[true, 'A tour must have a price']</span>
  }
});

const port = process.env.PORT || 3000;
app.listen(port, () =&gt; {
	console.log(`App running on port ${port}...`);
});</span></pre>
		</div>
	</section>



	<h3>Step #2: Create a Model</h3>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>This creates a Model from the Schema.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">const mongoose = require('mongoose');
const dotenv = require('dotenv');
const app = require('./app');

dotenv.config({ path: './config.env' });

const DB = process.env.DATABASE.replace(
 '&lt;PASSWORD&gt;',
 process.env.DATABASE_PASSWORD
);

mongoose
 .connect(DB, {
   useNewUrlParser: true,
	 useCreateIndex: true,
	 useFindAndModify: false
})
.then(() =&gt; console.log('DB connection successful'));

<span class="code-comment">// Create Schema. Pass in the Schema as an Object</span>
const tourSchema = new mongoose.Schema({
  name: {
    type: String,
    required: [true, 'A tour must have a name'],
		unique: true
  },
  rating: {
    type: Number,
    default: 4.5
  },
  price: {
    type: Number,
    required: [true, 'A tour must have a price']
  }
});

<span class="code-comment">// Use uppercase on Model names
// Add schema after the name</span>
<span class="code-highlight">const Tour = mongoose.model('Tour', tourSchema);</span>

const port = process.env.PORT || 3000;
app.listen(port, () =&gt; {
	console.log(`App running on port ${port}...`);
});</span></pre>
		</div>
	</section>









	<h2>Create Documents using the Model</h2>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>This creates a Document from the Model.</p>
			<p>The new Document contains methods you can use to interact with the database. For example, <span
					class="code">save()</span>.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">const mongoose = require('mongoose');
const dotenv = require('dotenv');
const app = require('./app');

dotenv.config({ path: './config.env' });

const DB = process.env.DATABASE.replace(
 '&lt;PASSWORD&gt;',
 process.env.DATABASE_PASSWORD
);

mongoose
 .connect(DB, {
   useNewUrlParser: true,
	 useCreateIndex: true,
	 useFindAndModify: false
})
.then(() =&gt; console.log('DB connection successful'));

<span class="code-comment">// Create Schema. Pass in the Schema as an Object</span>
const tourSchema = new mongoose.Schema({
  name: {
    type: String,
    required: [true, 'A tour must have a name'],
		unique: true
  },
  rating: {
    type: Number,
    default: 4.5
  },
  price: {
    type: Number,
    required: [true, 'A tour must have a price']
  }
});

const Tour = mongoose.model('Tour', tourSchema);

<span class="code-comment">// Create new Document based off Tour Model
// This new Document has methods attached to it from the Schema which allow you to interact with the database</span>
<span class="code-highlight">const testTour = new Tour ({
 name: 'The FOrest Hiker',
 rating: 4.7,
 price: 497
})</span>

<span class="code-comment">// Using Methods
// This saves it to the Tours collection in the database
// This returns a Promise which you can then consume</span>
<span class="code-highlight">testTour.save()</span>



const port = process.env.PORT || 3000;
app.listen(port, () =&gt; {
	console.log(`App running on port ${port}...`);
});</span></pre>
		</div>
	</section>



	<h3>Consume the Promise from the save() method</h3>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>This consumes the Promise from teh <span class="code">save()</span> method.</p>
			<p>Use <span class="code">.then()</span> and <span class="code">catch()</span>.</p>
			<p>Run <span class="code">nodemon server.js</span> to start your server. When you save the new code, you'll see
				the output in the terminal saving it to the database.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">const mongoose = require('mongoose');
const dotenv = require('dotenv');
const app = require('./app');

dotenv.config({ path: './config.env' });

const DB = process.env.DATABASE.replace(
	'&lt;PASSWORD&gt;',
	process.env.DATABASE_PASSWORD
);

mongoose
	.connect(DB, {
		useNewUrlParser: true,
		useCreateIndex: true,
		useFindAndModify: false
})
.then(() =&gt; console.log('DB connection successful'));

<span class="code-comment">// Create Schema. Pass in the Schema as an Object</span>
const tourSchema = new mongoose.Schema({
	name: {
		type: String,
		required: [true, 'A tour must have a name'],
		unique: true
	},
	rating: {
		type: Number,
		default: 4.5
	},
	price: {
		type: Number,
		required: [true, 'A tour must have a price']
	}
});

const Tour = mongoose.model('Tour', tourSchema);

<span class="code-comment">// Create new Document based off Tour Model
// This new Document has methods attached to it from the Schema which allow you to interact with the database</span>
const testTour = new Tour ({
	name: 'The FOrest Hiker',
	rating: 4.7,
	price: 497
})


<span class="code-comment">// Using Methods
// This saves it to the Tours collection in the database
// This returns a Promise which you can then consume
// then() has access to the document you just saved to the databse
// Add catch() in case saving errors </span>
<span class="code-highlight">testTour.save()
 .then(doc =&gt; {
   console.log(doc);
 })
 .catch(err =&gt; {
  console.log('ERROR', err);
 });

const port = process.env.PORT || 3000;
app.listen(port, () =&gt; {
 console.log(`App running on port ${port}...`);
});
</span></pre>
		</div>
	</section>


	<h3>View the saved Document in Compass</h3>
	<div class="text-section">
		<p>Open Compass.</p>
		<p>Make sure you're connected to the external database as shown above.
		<p>Click into <span class="code">natours.tours</span> and you should see the following.</p>
		<img src="../../_img/compass-new-document.png">
	</div>












	<h1>Back-End Architecture</h1>
	<h2>MVC Architecture</h2>

	<h3>MODEL (Business Logic)</h3>
	<div class="text-section">
		<p>This layer is concerned with application data and business logic.</p>
	</div>



	<h3>CONTROLLER (Application Logic)</h3>
	<div class="text-section">
		<p>Handles the application request. Interacts with Models. Sends back responses to the client.</p>
	</div>


	<h3>View (Presentation Logic)</h3>
	<div class="text-section">
		<p>Necessary if there's a graphical interface in your application. Uses templates to generate the view.</p>
	</div>


	<h2>Example of MVC</h2>
	<img src="../../_img/mvc-architecture.png" width="800px">
	<h4>Step #1: The Request</h4>
	<div class="text-section">
		<p>A request will hit one of the Routers.</p>
	</div>

	<h4>Step #2: Routers</h4>
	<div class="text-section">
		<p>This delegates the request to the correct handler function in the Controller.</p>
	</div>

	<h4>Step #3: The Controller</h4>
	<div class="text-section">
		<p>There is a Controller for each resource.</p>
	</div>

	<h4>Step #4: The Model</h4>
	<div class="text-section">
		<p>The Controller will then interact with the Model to retrieve information from the database.</p>
	</div>

	<h4>Step #5: The View</h4>
	<div class="text-section">
		<p>The Controller selects a view template and injects data into it.</p>
	</div>

	<h4>Step #6: The Response</h4>
	<div class="text-section">
		<p>The Controller then sends back the data to the client.</p>
	</div>


	<h2>Application Logic vs Business Logic</h2>
	<img src="../../_img/mvc-application-business-logic.png" width="800px">





	<h1>Refactoring</h1>



	<h2>Split out code into Model</h2>
	<section class="code-section-container">
		<div class="code-text-section">
			<ol>
				<li>Create a new directory name <span class="text-object">models</span>.</li>
				<li>Create a new file in that directory named <span class="text-object">tourModel.js</span>.</li>
				<li>From the <span class="text-object">server.js</span> file copy the Mongoose import statement into the <span
						class="text-object">tourModel.js</span> file.</li>
				<li>From the <span class="text-object">server.js</span> file cut out the Schema, and
					Model declaration and place it in the <span class="text-object">tourModel.js</span> file.</li>
				<li>Finally, add an export statement at the bottom to export the Model.</li>
			</ol>
		</div>
		<div class="code-block-section-w60">
			<span class="file-name">tourModel.js</span>
			<pre class="example"><span class="code-nodejs">const mongoose = require('mongoose');
<span class="code-comment">// Create Schema. Pass in the Schema as an Object</span>
const tourSchema = new mongoose.Schema({
 name: {
  type: String,
  required: [true, 'A tour must have a name'],
  unique: true
 },
  rating: {
  type: Number,
  default: 4.5
 },
  price: {
  type: Number,
  required: [true, 'A tour must have a price']
 }
});

<span class="code-comment">// Use uppercase on Model names
// Add schema after the name</span>
const Tour = mongoose.model('Tour', tourSchema);

module.exports = Tour;</span></pre>
		</div>
	</section>


	<h2>Update Controller to require the Model</h2>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Add the require statement in the <span class="text-object">tourController.js</span> file to require the new
				<span class="text-object">tourModel.js</span> file.
			</p>
			<p>Add it at the top.</p>
		</div>
		<div class="code-block-section-w60"><span class="file-name">tourController.js</span>
			<pre class="example"><span class="code-nodejs">const Tour = require('./../models/tourModel');</span></pre>
		</div>
	</section>

	<h3>Remove old test code</h3>
	<div class="text-section">
		<p>Remove test code from <span class="text-object">tourController.js</span> that was used in testing with the
			imported JSON file.</p>
		<p>Also remove Middleware referencing <span class="code">checkID</span> from <span
				class="text-object">tourController.js</span> and <span class="text-object">tourRoutes.js</span>.</p>
		<p>Remove the <span class="code">fs</span> import.</p>
	</div>


	<h3>Current tourController.js file</h3>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>The following is how the <span class="text-object">tourController.js</span> file should now appear.</p>
		</div>
		<div class="code-block-section-w60"><span class="file-name">tourController.js</span>
			<pre class="example"><span class="code-nodejs">const Tour = require('./../models/tourModel');



exports.getAllTours = (req, res) => {
  console.log(req.requestTime);

  res.status(200).json({
    status: 'success',
    requestedAt: req.requestTime
  });
};

exports.getTour = (req, res) => {
  console.log(req.params);
  const id = req.params.id * 1;
};

exports.createTour = (req, res) => {
  res.status(201).json({
    status: 'success'
  });
};

exports.updateTour = (req, res) => {
  res.status(200).json({
    status: 'success',
    data: {
      tour: '<Updated tour here...>'
    }
  });
};

exports.deleteTour = (req, res) => {
  res.status(204).json({
    status: 'success',
    data: null
  });
};</span></pre>
		</div>
	</section>























	<h1>Mongoose Queries</h1>
	<div class="text-section">
		<p>The following examples uses methods specific to Mongoose.</p>
		<ul>
			<li><a href="https://mongoosejs.com/docs/queries.html" target="_blank">Mongoose Queries</a></li>
		</ul>
		<div class="notebox-note">
			<p>If a Mongoose method starts with <span class="code">Model.prototype.</span>, it means it cannot be used on the
				Model itself, on an instance of that Model.</p>
			<p>For example, you could run <span class="code">save()</span> on a document created by a Model, but you couldn't
				use it on the Model directly.</p>
		</div>
	</div>







	<h1>Another way to create a Document</h1>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>This example uses the <span class="code">create()</span> method directly on the <span class="code">Tour</span>
				Model.</p>
			<p>Pass in the POST body request using <span class="code">req.body</span>. This is the data you want to store in
				the database as a new Tour.</p>
			<p><span class="code">create()</span> returns a Promise. Use Async/Await to store the result into <span
					class="code">newTour</span>.</p>
			<p><span class="code">newTour</span> is the new document.</p>
			<p>Finally, wrap everything in a <span class="code">try/catch</span> block to check for errors.</p>
			<p>In <span class="text-object">Postman</span>, visit POST 127.0.0.1:3000/api/v1/tours. Enter a new tour and click
				SEND. You'll see the result was saved to the database.</p>
			<img src="../../_img/postman-create-tour.png">
			<div class="notebox-note">
				<p>Notice how <span class="code">difficulty</span> and <span class="code">price</span> are not added to the
					database. That's because they are not in the Schema. Only data listed in the Schema can be added.</p>
			</div>

		</div>


		<div class="code-block-section-w60"><span class="file-name">tourController.js</span>
			<pre class="example"><span class="code-nodejs">const Tour = require('./../models/tourModel');

<span class="code-highlight">exports.createTour = async (req, res) =&gt; {
  try {</span>
    <span class="code-comment">// Create a new Tour by calling the create method on the model
    // create() returns a Promise
    // Instead of using .then(), use Async/Await
    // The resolved value of the Promise is stored in the newTour variable
    // req.body is the data from the POST request</span>
    <span class="code-highlight">const newTour = await Tour.create(req.body);

    res.status(201).json({
      status: 'success',
      data: {
        tour: newTour
      }
    });
  } catch (err) {
    res.status(400).json({
      status: 'fail',
      message: err
    });
  }
};</span></span></pre>
		</div>
	</section>




	<h1>View all Documents using find()</h1>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Use Async/Await.</p>
			<p>Create a variable to store the retrieved data. It's called <span class="code">tours</span>.</p>
			<p>This variable saves from the Model named <span class="code">Tour</span>.</p>
			<p>It is attached to the <span class="code">find()</span> method which returns all data.</p>
			<p>Wrap everything in a <span class="code">try/catch</span> block.</p>
			<p>In <span class="text-object">Postman</span>, visit GET 127.0.0.1:3000/api/v1/tours.</p>
		</div>
		<div class="code-block-section-w60"><span class="file-name">tourController.js</span>
			<pre class="example"><span class="code-nodejs">const Tour = require('./../models/tourModel');

exports.getAllTours = async (req, res) =&gt; {
  try {
    <span class="code-comment">// Get all tours
    // Tour Model followed by find() method </span>
    <span class="code-highlight">const tours = await Tour.find();

    res.status(200).json({
      status: 'success',
      results: tours.length,
      data: {
        tours
      }
    });
  } catch (err) {
    res.status(404).json({
      status: 'fail',
      message: err
    });
  }
};</span></span></pre>
		</div>
	</section>











	<h1>View a single Document using findById()</h1>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>Mongoose provides <span class="code">findById()</span>.</p>
			<p>This example uses <span class="code">Tour.findById(req.params.id);</span> to locate the ID#.</p>
			<p>This is the same as writing <span class="code">Tour.findOne({_id: req.params.id })</span> in normal Node.js
				code.</p>
			<p>To test in <span class="text-object">Postman</span> grab an ID# from the full list of documents from the
				example above. It will look like <span class="code">62829dbc2ef9f0608c062681</span>. Then make a GET request to
				<span class="code">127.0.0.1:3000/api/v1/tours/62829dbc2ef9f0608c062681</span> to view this single result.
			</p>
		</div>

		<div class="code-block-section-w60"><span class="file-name">tourController.js</span>
			<pre class="example"><span class="code-nodejs">const Tour = require('./../models/tourModel');

exports.getTour = async (req, res) => {
  try {
    <span class="code-comment">// id comes from tourRoutes.js: .route('/:id')</span>
    const tour = await Tour.findById(req.params.id);

    res.status(200).json({
      status: 'success',
      data: {
        tour
      }
    });
  } catch (err) {
    res.status(404).json({
      status: 'fail',
      message: err
    });
  }
};</span></span></pre>
		</div>
	</section>











	<h1>Updating Documents</h1>



	<section class="code-section-container">
		<div class="code-text-section">
			<p>Mongoose provides <span class="code">findByIdAndUpdate()</span>.</p>
			<ul>
				<li><a href="https://mongoosejs.com/docs/api.html#model_Model.findByIdAndUpdate"
						target="_blank">findByIdAndUpdate</a></li>
			</ul>
			<p>In <span class="text-object">Postman</span> send a PATCH request <span
					class="code">127.0.0.1:3000/api/v1/tours/62829dbc2ef9f0608c062681</span>. In the <span
					class="text-object">body</span> section, add what you want to change.</p>
			<p>Click SEND and you'll see the record updated.</p>

			<img src="../../_img/postman-patch-tour.png">
		</div>

		<div class="code-block-section-w60"><span class="file-name">tourController.js</span>
			<pre class="example"><span class="code-nodejs">const Tour = require('./../models/tourModel');
	
exports.updateTour = async (req, res) =&gt; {
  try {
    <span class="code-comment">// Query for document by ID# to udpate, then update it
    // First argument is ID#, second is what to change, 3rd is options</span>
    const tour = await Tour.findByIdAndUpdate(req.params.id, req.body, {
      new: true, <span class="code-comment">// new updated document will be returned</span>
      runValidators: true <span class="code-comment">// each update runs validators specified in the Schema</span>
    });

    res.status(200).json({
      status: 'success',
      data: {
        tour // the tour property is set to the tour object. In ES6, you can just write it as tour and not tour: tour
      }
    });
  } catch (err) {
    res.status(404).json({
      status: 'fail',
      message: err
    });
  }
};</span></span></pre>
		</div>
	</section>














	<h1>Deleting Documents</h1>



	<section class="code-section-container">
		<div class="code-text-section">
			<p>Get all tours in Postman.</p>
			<p>Copy the ID# of the one you want to delete.</p>
			<p>In Postman, send a <span class="code">DELETE</span> request to <span
					class="code">127.0.0.1:3000/api/v1/tours/628eaeb35b43987cbc4bc583</span>.</p>
			<p>There will be no reply but you should see a <span class="code">204</span> response.</p>


		</div>

		<div class="code-block-section-w60"><span class="file-name">tourController.js</span>
			<pre class="example"><span class="code-nodejs">const Tour = require('./../models/tourModel');
	
exports.deleteTour = (req, res) =&gt; {
  res.status(204).json({
    status: 'success',
    data: null
  });
};

exports.deleteTour = async (req, res) =&gt; {
  try {
    // there's nothing to send back to the client so you do not need to save to a variable
    await Tour.findByIdAndDelete(req.params.id);

    res.status(204).json({
      status: 'success',
      data: null
    });
  } catch (err) {
    res.status(404).json({
      status: 'fail',
      message: err
    });
  }
};</span></span></pre>
		</div>
	</section>









	<h1>Update the tourModel.js and send data into it</h1>


	<h2>New tourModel.js fields</h2>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>This is the new <span class="code">tourMode.js</span> file. New fields have been added to the Schema.</p>
			<p>This allows you to send requests with these new fields and data.</p>
		</div>
		<div class="code-block-section-w60"><span class="file-name">tourModel.js</span>
			<pre class="example"><span class="code-nodejs">const mongoose = require('mongoose');

// Create Schema. Pass in the Schema as an Object
const tourSchema = new mongoose.Schema({
  name: {
    type: String,
    required: [true, 'A tour must have a name'],
    unique: true,
    trim: true
  },
  duration: {
    type: Number,
    required: [true, 'A tour must have a duration']
  },
  maxGroupSize: {
    type: Number,
    required: [true, 'A tour must have a group size']
  },
  difficulty: {
    type: String,
    required: [true, 'A tour must have a difficulty']
  },
  ratingsQuantity: {
    type: Number,
    defautl: 0
  },
  rating: {
    type: Number,
    default: 4.5
  },
  price: {
    type: Number,
    required: [true, 'A tour must have a price']
  },
  priceDiscount: Number,
  summary: {
    type: String,
    trim: true, <span class="code-comment">// removes white space around String</span>
    required: [true, 'A tour must have a description']
  },
  description: {
    type: String,
    trim: true
  },
  imageCover: {
    type: String,
    required: [true, 'A tour must have a cover image']
  }, <span class="code-comment">// save images as an Array of Strings. Just place brackets around String</span>
  images: [String],
  createdAt: {
    type: Date,
    default: Date.now() <span class="code-comment">// get current timestamp</span>
  },
  startDates: [Date]
});

<span class="code-comment">// Use uppercase on Model names
// Add schema after the name</span>
const Tour = mongoose.model('Tour', tourSchema);

module.exports = Tour;
</span></pre>
		</div>
	</section>



	<h2>Send data into app in Postman</h2>

	<div class="text-section">
		<p>You can now use Postman to send data into the app using the new fields in the Schema.</p>
		<img src="../../_img/postman-post-data.png">
	</div>



	<h2>Script to load JSON data into the database</h2>

	<section class="code-section-container">
		<div class="code-text-section">
			<p>This script is run once to import everything in the JSON file.</p>
			<p>Create a new file named <span class="text-object">import-dev-data.js</span> in the <span
					class="text-object">dev-data/data/</span> directory.</p>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">const fs = require('fs'); // to read the JSON file
const dotenv = require('dotenv');
const mongoose = require('mongoose');
const Tour = require('./../../models/tourModel'); // to access the tourModel so you can write to it

dotenv.config({ path: './config.env' });

<span class="code-comment">// process.env.DATABASE is the variable in the config.env file
// This replaces the password variable in the connection string with the real password from the password variable</span>
const DB = process.env.DATABASE.replace(
  '&lt;PASSWORD&gt;',
  process.env.DATABASE_PASSWORD
);

<span class="code-comment">// pass in database connection string
// then pass in an Object with some options (these deal with deprecation warnings)
// This connection returns a promise. Handle it using then()
// This gives you access to a connection Object</span>
mongoose
  .connect(DB, {
    useNewUrlParser: true,
    useCreateIndex: true,
    useFindAndModify: false
  }) <span class="code-comment">// this connection will be the resolved value of the Promise</span>
  .then(() =&gt; console.log('DB connection successful'));

<span class="code-comment">// Read JSON file
// Convert to a JavaScript Object using JSON.parse()</span>
const tours = JSON.parse(
  fs.readFileSync(`${__dirname}/tours-simple.json`, 'utf-8')
);

<span class="code-comment">// Import data</span>
const importData = async () =&gt; {
  try {
    <span class="code-comment">// create method can accept an Array of Objects to create a new document for each Object in the Array</span>
    await Tour.create(tours);
    console.log('Data successfully loaded!');
  } catch (err) {
    console.log(err);
  }
	<span class="code-comment">ends the Node.js application. This is ok because this is a simple script</span>
	process.exit(); 
};

<span class="code-comment">// Delete all data from database</span>
const deleteData = async () =&gt; {
  try {
    <span class="code-comment">// use deleteMany() with no arguments to delete all documents in a collection
    // This is a Mongoose function, but it's the same name as the native MongoDB function</span>
    await Tour.deleteMany(tours);
    console.log('Data successfully deleted!');	
  } catch (err) {
    console.log(err);
  }
	<span class="code-comment">ends the Node.js application. This is ok because this is a simple script</span>
	process.exit(); 
};

<span class="code-comment">// if 3rd element in arguments Array is equal to --import, run the importData function</span>
if (process.argv[2] === '--import') {
  importData();
} else if (process.argv[2] === '--delete') {
  deleteData();
}

<span class="code-comment">// This prints the arguments of the Node process</span>
console.log(process.argv);
</span></pre>
		</div>
	</section>


	<h3>Run the file</h3>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>When you run the file, nothing happens. This is because there are no function calls in the script.</p>
			<p>You will only see the Node arguments printed from <span class="code">process.argv</span>
		</div>
		<div class="code-block-section-w60">
			<pre class="example"><span class="code-nodejs">node dev-data/data/import-dev-data.js
[
  'C:\\Program Files\\nodejs\\node.exe',
  'C:\\Users\\chris_opmq71j\\Documents\\webdev\\my-tutorials\\my-tutorials\\my-nodejs-tutorial\\udemy\\complete-node-bootcamp-master\\4-natours\\after-
section-06\\dev-data\\data\\import-dev-data.js'
]
</span></pre>
		</div>
	</section>

	<h3>Run the file and its functions</h3>


	<h4>Delete all data</h4>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>Add an option to the command using <span class="code">--import</span> or <span class="code">--delete</span>.
			</p>
			<p>This option triggers the function call from the <span class="code">if</span> statement.</p>
			<p>
		</div>
		<div class="code-block-section-w60">
			<pre
				class="example"><span class="code-nodejs">node dev-data/data/import-dev-data.js <span class="code-highlight">--delete</span></span></pre>
		</div>
	</section>

	<h4>Import new data</h4>
	<section class="code-section-container">
		<div class="code-text-section">
			<p>Run the command using <span class="code">--import</span> to import from the JSON file.
			<p>
		</div>
		<div class="code-block-section-w60">
			<pre
				class="example"><span class="code-nodejs">node dev-data/data/import-dev-data.js <span class="code-highlight">--import</span></span></pre>
		</div>
	</section>








































</body>

</html>